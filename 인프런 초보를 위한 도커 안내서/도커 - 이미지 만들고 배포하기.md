# 도커 - 이미지 만들고 배포하기



## 목차

1. 도커 이미지 만들기 - 기본
2. 도커 허브 이미지 관리와 배포

------



## 1. 도커 이미지 만들기

### 이미지란?

- 프로세스가 실행되는 파일(환경)들의 집합
- 프로세스는 환경을 변경할 수 있다.
- 이 환경을 저장해서 새로운 이미지를 만든다.
- 이미지는 두가지로 나누어 진다.
  - Only Read (읽기 전용 영역)
    - Base Image
    - ex) 우분투 이미지를 변경할 수 없다.
  - Writable (쓰기 가능 영역)
    - ex) 우분투 이미지를 변경할 수 없지만, **git 등을 설치해서 새로운 이미지를 만들 수 있다.**

![이미지_영역.png](https://github.com/jo-minjun/docker-study/blob/main/image/%EC%9D%B4%EB%AF%B8%EC%A7%80_%EC%98%81%EC%97%AD.png)

### commit으로 이미지 만들기

```bash
docker commit git ubuntu:git
```

- 기존 컨테이너에 git 등 프로그램을 설치해서 commit하면 새로운 이미지를 얻을 수 있다.

### build로 이미지 만들기

```bash
docker build -t {이름}/{이미지 이름}:{태그} .
```

- 이미지는 위와 같은 naming 룰을 가진다.

- 이미지에 이름 영역이 없으면 공식 이미지이다.

- 도커 이미지를 만들기 위해서는 Dockerfile을 사용한다.

  - Dockerfile 주요 명령어

  | FROM       | 기본 이미지                                          |
  | ---------- | ---------------------------------------------------- |
  | RUN        | 쉘 명령어 실행                                       |
  | CMD        | 컨테이너 기본 실행 명령어 (Entrypoint의 인자로 사용) |
  | EXPOSE     | 오픈되는 포트 정보                                   |
  | ENV        | 환경변수 설정                                        |
  | ADD        | 파일 또는 디렉토리 추가. URL/ZIP 사용 가능           |
  | COPY       | 파일 또는 디렉토리 복사                              |
  | ENTRYPOINT | 컨테이너 기본 실행 명령어                            |
  | VOLUME     | 외부 마운트 포인트 생성                              |
  | USER       | RUN, CMD, ENTRYPOINT를 실행하는 사용자               |
  | WORKDIR    | 작업 디렉토리 설정                                   |
  | ARGS       | 빌드타임 환경변수 설정                               |
  | LABEL      | key - value 데이터                                   |
  | ONBUILD    | 다른 필드의 베이스로 사용될 때 사용하는 명령어       |

### .dockerignore

- .gitignore과 비슷한 역할
- 도커 빌드 컨텍스트에서 지정된 패턴의 파일을 무시
- .git이나 민감한 정보를 제외하는 용도로 주로 사용
- .git이나 에셋 디렉토리만 제외해도 빌드 속도가 개선됨
- 이미지 빌드시에 사용하는 파일은 제외시키면 안됨



## 2. 도커 허브 이미지 관리와 배포

### 도커 허브

- 도커 이미지를 저장하는 저장소이다.
- 무료는 public 이지만 (1개까지 private 가능), 유료는 private으로 사용할 수 있다.

### 이미지 저장 명령어

```bash
docker login
docker push {ID}/example
docker pull {ID}/example
```

- push를 사용하면 도커 허브에 이미지가 업로드된다.

### 배포하기

```bash
docker run -d -p 1234:1234 {ID}/example
```

- 컨테이너를 실행하면 이미지가 pull 되고, 컨테이너가 start된다.
- 따라서 local 작업에서 이미지를 만들어 push를 해두면, docker pull을 사용하지 않아도 배포할 수 있다.
